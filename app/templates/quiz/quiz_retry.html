{# app/templates/quiz/quiz_retry.html #}
{% extends "base.html" %}
{% block title %}不正解だけ再挑戦 | Learning SaaS{% endblock %}

{% block content %}
<div class="container my-4">
  <div class="mb-3">
    <div class="text-muted small mb-1">
      <a href="{{ url_for('main.course_detail', course_id=original.lesson.course.id) }}">
        {{ original.lesson.course.title }}
      </a>
      &raquo;
      <a href="{{ url_for('main.lesson_detail', lesson_id=original.lesson.id) }}">
        {{ original.lesson.title }}
      </a>
    </div>
    <h2 class="h4 mb-1">不正解だけ再挑戦モード</h2>
    <p class="text-muted small mb-0">
      対象の結果: {{ original.taken_at.strftime("%Y-%m-%d %H:%M") }}
      / スコア {{ original.score }} / {{ original.total_questions }} 問
    </p>
  </div>

  <form method="post" action="{{ url_for('main.quiz_retry_submit', result_id=original.id) }}">
    {% for q in questions %}
      <div class="card mb-3 shadow-sm">
        <div class="card-body">
          <div class="mb-2">
            <span class="badge bg-secondary me-1">Q{{ loop.index }}</span>
            {{ q.question_text }}
          </div>

          {% for ch in q.choices %}
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="q{{ q.id }}"
                id="q{{ q.id }}_{{ loop.index }}"
                value="{{ ch.id }}"
              >
              <label class="form-check-label" for="q{{ q.id }}_{{ loop.index }}">
                {{ ch.choice_text }}
              </label>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}

    <div class="d-flex justify-content-between align-items-center mt-4">
      <a href="{{ url_for('main.quiz_result_detail', result_id=original.id) }}"
         class="btn btn-outline-secondary">
        元の結果に戻る
      </a>
      <button type="submit" class="btn btn-primary">
        採点する
      </button>
    </div>
  </form>
</div>
{% endblock %}
